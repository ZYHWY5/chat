import{r as d,F as D,d as E,G as I,u as L,H as N,k as $,o as U,y as w,z as _,A as e,I as R,J as z,K as a,B as b,L as j,M as V,N as A,O as H,P as K,Q as F,R as O,S as P,_ as q}from"./DyUvST2q.js";function G(B,W={}){const{autoReconnect:S=!0,reconnectInterval:v=3e3,maxReconnectAttempts:g=5}=W,o=d(null),n=d("disconnected"),l=d(""),i=d(0),f=d([]);let m=null;const u=()=>`${Date.now()}-${Math.random().toString(36).substring(2,9)}`,p=s=>{const r=new Date(s),c=r.getHours().toString().padStart(2,"0"),k=r.getMinutes().toString().padStart(2,"0");return`${c}:${k}`},x=(s,r)=>{const c={id:u(),type:s,content:r,timestamp:Date.now()};f.value.push(c),console.log(`${s==="sent"?"ğŸ“¤":"ğŸ“¨"} æ¶ˆæ¯:`,r)},y=()=>{m&&(clearTimeout(m),m=null)},M=s=>{const r=s||B;if(!r){l.value="WebSocket URL ä¸èƒ½ä¸ºç©º",n.value="error";return}o.value&&h();try{n.value="connecting",l.value="",console.log("ğŸ”Œ æ­£åœ¨è¿æ¥:",r),o.value=new WebSocket(r),o.value.onopen=()=>{console.log("âœ… WebSocket è¿æ¥æˆåŠŸ"),n.value="connected",i.value=0},o.value.onmessage=c=>{const k=c.data;console.log("ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯:",k),k.toLowerCase()!=="pong"&&x("received",k)},o.value.onerror=c=>{console.error("âŒ WebSocket é”™è¯¯:",c),l.value="WebSocket è¿æ¥é”™è¯¯",n.value="error"},o.value.onclose=c=>{console.log("ğŸ”Œ WebSocket è¿æ¥å…³é—­",c.code,c.reason),n.value="disconnected",S&&i.value<g?(i.value++,console.log(`ğŸ”„ å°è¯•é‡è¿ (${i.value}/${g})...`),y(),m=setTimeout(()=>{M(r)},v)):i.value>=g&&(l.value=`é‡è¿å¤±è´¥ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡è¿æ¬¡æ•° (${g})`,n.value="error")}}catch(c){console.error("âŒ åˆ›å»º WebSocket å¤±è´¥:",c),l.value=c instanceof Error?c.message:"æœªçŸ¥é”™è¯¯",n.value="error"}},h=()=>{y(),o.value&&(console.log("ğŸ”Œ æ–­å¼€ WebSocket è¿æ¥"),o.value.close(),o.value=null),n.value="disconnected",i.value=0},C=()=>{l.value=""},T=s=>{if(!o.value)return l.value="WebSocket æœªè¿æ¥",!1;if(o.value.readyState!==WebSocket.OPEN)return l.value="WebSocket è¿æ¥æœªå°±ç»ª",!1;try{return o.value.send(s),x("sent",s),!0}catch(r){return console.error("âŒ å‘é€æ¶ˆæ¯å¤±è´¥:",r),l.value=r instanceof Error?r.message:"å‘é€å¤±è´¥",!1}},t=()=>{f.value=[]};return D(()=>{h()}),{ws:o,status:n,error:l,reconnectAttempts:i,messages:f,connect:M,disconnect:h,sendMessage:T,clearMessages:t,resetError:C,formatTime:p}}const J={class:"chat-container"},Q={class:"chat-wrapper"},X={class:"chat-card"},Y={class:"chat-header"},Z={class:"header-left"},ee={class:"connection-info"},te={class:"connection-status"},se={class:"status-text"},oe={class:"connection-url"},ne=["disabled"],ae={class:"messages-list"},re={key:0,class:"empty-state"},ce={class:"message-content"},le={class:"message-text"},ie={class:"message-time"},ue={key:0,class:"error-banner"},de={class:"input-container"},ve=["disabled"],ge=["disabled"],me=E({__name:"chat",setup(B){const W=I(),S=L(),v=d(W.query.url||"");v.value||S.push("/");const{connect:g,disconnect:o,status:n,error:l,messages:i,sendMessage:f,formatTime:m}=G(),u=d(""),p=d(null),x=()=>{P(()=>{p.value&&(p.value.scrollTop=p.value.scrollHeight)})};N(i,()=>{x()});const y=$(()=>{switch(n.value){case"connecting":return"è¿æ¥ä¸­...";case"connected":return"å·²è¿æ¥";case"disconnected":return"æœªè¿æ¥";case"error":return"è¿æ¥é”™è¯¯";default:return"æœªçŸ¥"}}),M=$(()=>{switch(n.value){case"connected":return"status-connected";case"connecting":return"status-connecting";case"error":return"status-error";default:return"status-disconnected"}});U(()=>{v.value&&g(v.value)});const h=()=>{o(),S.push("/")},C=()=>{u.value.trim()&&(f(u.value.trim()),u.value="")};return(T,t)=>(_(),w("div",J,[t[8]||(t[8]=e("div",{class:"background-gradient"},null,-1)),e("div",Q,[e("div",X,[e("div",Y,[e("div",Z,[e("button",{class:"back-button",onClick:h},[...t[4]||(t[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"back-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),e("div",ee,[e("div",te,[e("span",{class:z(["status-dot",a(M)])},null,2),e("span",se,b(a(y)),1)]),e("div",oe,b(a(v)),1)])]),e("button",{class:"disconnect-button",onClick:t[0]||(t[0]=(...s)=>a(o)&&a(o)(...s)),disabled:a(n)!=="connected"}," æ–­å¼€è¿æ¥ ",8,ne)]),e("div",{ref_key:"messagesContainer",ref:p,class:"messages-container"},[e("div",ae,[a(i).length===0?(_(),w("div",re,[...t[5]||(t[5]=[j('<div class="empty-icon" data-v-fd30127a><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-fd30127a><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" data-v-fd30127a></path></svg></div><p class="empty-text" data-v-fd30127a>æš‚æ— æ¶ˆæ¯</p><p class="empty-hint" data-v-fd30127a>å‘é€ä¸€æ¡æ¶ˆæ¯å¼€å§‹èŠå¤©å§</p>',3)])])):R("",!0),(_(!0),w(V,null,A(a(i),s=>(_(),w("div",{key:s.id,class:z(["message",s.type==="sent"?"message-sent":"message-received"])},[e("div",ce,[e("p",le,b(s.content),1),e("span",ie,b(a(m)(s.timestamp)),1)])],2))),128))])],512),a(l)?(_(),w("div",ue,[t[6]||(t[6]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"error-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,b(a(l)),1)])):R("",!0),e("div",de,[H(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>O(u)?u.value=s:null),type:"text",placeholder:"è¾“å…¥æ¶ˆæ¯...",class:"message-input",onKeyup:t[2]||(t[2]=F(s=>C(),["enter"])),disabled:a(n)!=="connected"},null,40,ve),[[K,a(u)]]),e("button",{class:"send-button",onClick:t[3]||(t[3]=s=>C()),disabled:!a(u).trim()||a(n)!=="connected"},[...t[7]||(t[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"send-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)])],8,ge)])])])]))}}),fe=q(me,[["__scopeId","data-v-fd30127a"]]);export{fe as default};
