# WebSocket å®æ—¶èŠå¤©åº”ç”¨

ä¸€ä¸ªåŸºäº Nuxt 3 å’Œ WebSocket æ„å»ºçš„å®æ—¶èŠå¤©åº”ç”¨ï¼Œæ”¯æŒå¤šäººåœ¨çº¿èŠå¤©ã€ç”¨æˆ·åè‡ªå®šä¹‰ç­‰åŠŸèƒ½ã€‚

## ğŸ“– ç›®å½•

- [æŠ€æœ¯åŸç†](#æŠ€æœ¯åŸç†)
  - [ä»€ä¹ˆæ˜¯ WebSocket](#ä»€ä¹ˆæ˜¯-websocket)
  - [ä»€ä¹ˆæ˜¯å†…ç½‘ç©¿é€](#ä»€ä¹ˆæ˜¯å†…ç½‘ç©¿é€)
  - [ä»€ä¹ˆæ˜¯ ngrok](#ä»€ä¹ˆæ˜¯-ngrok)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
- [éƒ¨ç½²](#éƒ¨ç½²)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)

---

## æŠ€æœ¯åŸç†

### ä»€ä¹ˆæ˜¯ WebSocket

**WebSocket** æ˜¯ä¸€ç§ç½‘ç»œé€šä¿¡åè®®ï¼Œæä¾›äº†æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„**å…¨åŒå·¥é€šä¿¡**é€šé“ã€‚

#### ä¼ ç»Ÿ HTTP vs WebSocket

**ä¼ ç»Ÿ HTTP è¯·æ±‚ï¼š**
```
å®¢æˆ·ç«¯ â†’ è¯·æ±‚ â†’ æœåŠ¡å™¨
å®¢æˆ·ç«¯ â† å“åº” â† æœåŠ¡å™¨
ï¼ˆæ¯æ¬¡é€šä¿¡éƒ½éœ€è¦å®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·ï¼‰
```

**WebSocket è¿æ¥ï¼š**
```
å®¢æˆ·ç«¯ â‡„ æŒä¹…è¿æ¥ â‡„ æœåŠ¡å™¨
ï¼ˆåŒæ–¹éƒ½å¯ä»¥éšæ—¶ä¸»åŠ¨å‘é€æ¶ˆæ¯ï¼‰
```

#### WebSocket çš„ä¼˜åŠ¿

1. **å®æ—¶æ€§å¼º** - æœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨æ¨é€æ¶ˆæ¯ç»™å®¢æˆ·ç«¯
2. **ä½å»¶è¿Ÿ** - æ— éœ€é‡å¤å»ºç«‹è¿æ¥ï¼Œå‡å°‘æ¡æ‰‹å¼€é”€
3. **åŒå‘é€šä¿¡** - å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥åŒæ—¶å‘é€å’Œæ¥æ”¶æ¶ˆæ¯
4. **èŠ‚çœå¸¦å®½** - ä¿æŒé•¿è¿æ¥ï¼Œå‡å°‘ HTTP è¯·æ±‚å¤´çš„å¼€é”€

#### é€‚ç”¨åœºæ™¯

- ğŸ’¬ å®æ—¶èŠå¤©åº”ç”¨
- ğŸ® åœ¨çº¿æ¸¸æˆ
- ğŸ“Š å®æ—¶æ•°æ®å¤§å±
- ğŸ“ ååŒç¼–è¾‘å·¥å…·
- ğŸ“ˆ è‚¡ç¥¨è¡Œæƒ…æ¨é€

---

### ä»€ä¹ˆæ˜¯å†…ç½‘ç©¿é€

**å†…ç½‘ç©¿é€**æ˜¯ä¸€ç§è®©å¤–ç½‘èƒ½å¤Ÿè®¿é—®å†…ç½‘æœåŠ¡çš„æŠ€æœ¯ã€‚

#### é—®é¢˜åœºæ™¯

é€šå¸¸æƒ…å†µä¸‹ï¼š
```
å¤–ç½‘ç”¨æˆ· âœ— æ— æ³•è®¿é—® â†’ è·¯ç”±å™¨ NAT â†’ ä½ çš„ç”µè„‘ (localhost:3000)
```

ä½ çš„æœ¬åœ°åº”ç”¨è¿è¡Œåœ¨ `localhost:3000`ï¼Œä½†ï¼š
- åªæœ‰ä½ è‡ªå·±çš„ç”µè„‘èƒ½è®¿é—®
- æœ‹å‹ã€åŒäº‹æ— æ³•è®¿é—®ä½ çš„åº”ç”¨
- æ‰‹æœºã€å…¶ä»–è®¾å¤‡æ— æ³•æµ‹è¯•

#### å†…ç½‘ç©¿é€è§£å†³æ–¹æ¡ˆ

```
å¤–ç½‘ç”¨æˆ· â†’ å…¬ç½‘æœåŠ¡å™¨ â†’ éš§é“ â†’ è·¯ç”±å™¨ NAT â†’ ä½ çš„ç”µè„‘
         (https://xxx.ngrok.io)        (localhost:3000)
```

é€šè¿‡ä¸­é—´æœåŠ¡å™¨å»ºç«‹éš§é“ï¼Œå°†å¤–ç½‘è¯·æ±‚è½¬å‘åˆ°ä½ çš„å†…ç½‘æœåŠ¡ã€‚

#### ä½¿ç”¨åœºæ™¯

- ğŸ“± åœ¨æ‰‹æœºä¸Šæµ‹è¯•æœ¬åœ°å¼€å‘çš„åº”ç”¨
- ğŸ¤ è®©è¿œç¨‹å›¢é˜Ÿæˆå‘˜è®¿é—®ä½ çš„å¼€å‘ç¯å¢ƒ
- ğŸ”— å¿«é€Ÿåˆ†äº«æ¼”ç¤º Demo
- ğŸ£ æ¥æ”¶ç¬¬ä¸‰æ–¹æœåŠ¡çš„ Webhook å›è°ƒ
- ğŸ§ª åœ¨çœŸå®ç½‘ç»œç¯å¢ƒä¸‹æµ‹è¯•åº”ç”¨

---

### ä»€ä¹ˆæ˜¯ ngrok

**ngrok** æ˜¯ä¸€ä¸ªæµè¡Œçš„å†…ç½‘ç©¿é€å·¥å…·ï¼Œå¯ä»¥ä¸ºæœ¬åœ°æœåŠ¡å¿«é€Ÿåˆ›å»ºå…¬ç½‘è®¿é—®åœ°å€ã€‚

#### å·¥ä½œåŸç†

```
1. ä½ å¯åŠ¨ ngrok:
   ngrok http 3000

2. ngrok åˆ†é…ä¸€ä¸ªå…¬ç½‘åœ°å€:
   https://abc123.ngrok-free.app

3. å»ºç«‹å®‰å…¨éš§é“:
   å¤–ç½‘è¯·æ±‚ â†’ ngrok äº‘æœåŠ¡ â†’ ä½ çš„ localhost:3000
```

#### ä¸»è¦ç‰¹ç‚¹

âœ… **é›¶é…ç½®** - æ— éœ€ä¿®æ”¹è·¯ç”±å™¨æˆ–é˜²ç«å¢™è®¾ç½®  
âœ… **HTTPS æ”¯æŒ** - è‡ªåŠ¨æä¾› SSL è¯ä¹¦  
âœ… **è·¨å¹³å°** - æ”¯æŒ Windowsã€Macã€Linux  
âœ… **å®æ—¶ç›‘æ§** - æä¾› Web ç•Œé¢æŸ¥çœ‹è¯·æ±‚æ—¥å¿—  
âœ… **å…è´¹ä½¿ç”¨** - æä¾›å…è´¹ç‰ˆæœ¬ä¾›å¼€å‘æµ‹è¯•

#### åŸºæœ¬ä½¿ç”¨

```bash
# å®‰è£… ngrokï¼ˆMacï¼‰
brew install ngrok

# ä¸ºæœ¬åœ° 3000 ç«¯å£åˆ›å»ºéš§é“
ngrok http 3000

# æŒ‡å®šåŸŸåï¼ˆéœ€è¦ä»˜è´¹ç‰ˆï¼‰
ngrok http 3000 --domain=your-domain.ngrok-free.app
```

#### é™åˆ¶

- å…è´¹ç‰ˆåŸŸåæ¯æ¬¡é‡å¯ä¼šå˜åŒ–
- æ¯ä¸ªéš§é“æœ‰å¸¦å®½é™åˆ¶
- ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒï¼ˆä»…ç”¨äºå¼€å‘æµ‹è¯•ï¼‰

---

## æŠ€æœ¯æ ˆ

### å‰ç«¯
- **[Nuxt 3](https://nuxt.com/)** - Vue.js å…¨æ ˆæ¡†æ¶
- **[Nuxt UI](https://ui.nuxt.com/)** - UI ç»„ä»¶åº“
- **[Tailwind CSS](https://tailwindcss.com/)** - åŸå­åŒ– CSS æ¡†æ¶
- **[TypeScript](https://www.typescriptlang.org/)** - ç±»å‹å®‰å…¨
- **[Day.js](https://day.js.org/)** - æ—¶é—´æ ¼å¼åŒ–

### åç«¯
- **[Node.js](https://nodejs.org/)** - JavaScript è¿è¡Œæ—¶
- **[ws](https://github.com/websockets/ws)** - WebSocket æœåŠ¡å™¨åº“

### å¼€å‘å·¥å…·
- **[ESLint](https://eslint.org/)** - ä»£ç æ£€æŸ¥
- **[pnpm](https://pnpm.io/)** - åŒ…ç®¡ç†å™¨
- **[ngrok](https://ngrok.com/)** - å†…ç½‘ç©¿é€å·¥å…·

---

## åŠŸèƒ½ç‰¹æ€§

âœ¨ **å®æ—¶æ¶ˆæ¯** - åŸºäº WebSocket çš„å®æ—¶åŒå‘é€šä¿¡  
ğŸ‘¥ **å¤šäººèŠå¤©** - æ”¯æŒå¤šä¸ªç”¨æˆ·åŒæ—¶åœ¨çº¿  
ğŸ·ï¸ **ç”¨æˆ·åè‡ªå®šä¹‰** - å¯è‡ªå®šä¹‰ä¿®æ”¹ç”¨æˆ·å  
ğŸ“± **å“åº”å¼è®¾è®¡** - é€‚é…å„ç§å±å¹•å°ºå¯¸  
ğŸ¨ **ç²¾ç¾ UI** - æ¸å˜èƒŒæ™¯ã€æµç•…åŠ¨ç”»  
ğŸ”„ **è‡ªåŠ¨é‡è¿** - è¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨å°è¯•é‡è¿  
ğŸ’¬ **ç³»ç»Ÿæ¶ˆæ¯** - ç”¨æˆ·åŠ å…¥/ç¦»å¼€æé†’  
â° **æ—¶é—´æ˜¾ç¤º** - æ¶ˆæ¯å‘é€æ—¶é—´æ ‡è®°  
ğŸš€ **å¿«é€Ÿéƒ¨ç½²** - æ”¯æŒéƒ¨ç½²åˆ° GitHub Pages

---

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Node.js** >= 18.0.0
- **pnpm** >= 8.0.0

### å®‰è£…

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd websocket

# å®‰è£…ä¾èµ–
pnpm install
```

### å¯åŠ¨å¼€å‘

**1. å¯åŠ¨ WebSocket æœåŠ¡å™¨**

åœ¨ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œï¼š

```bash
pnpm run ws:server
```

ä½ ä¼šçœ‹åˆ°ï¼š
```
ğŸš€ WebSocket æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼
ğŸ“¡ ç›‘å¬ç«¯å£: 8080
ğŸ”— æœ¬åœ°è¿æ¥: ws://localhost:8080
```

**2. å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨**

åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œï¼š

```bash
pnpm dev --port 3001
```

**3. è®¿é—®åº”ç”¨**

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:3001`

---

## ä½¿ç”¨æŒ‡å—

### æœ¬åœ°æµ‹è¯•

1. è®¿é—®é¦–é¡µï¼Œè¾“å…¥ WebSocket åœ°å€ï¼š
   ```
   ws://localhost:8080
   ```

2. ç‚¹å‡»"è¿æ¥"è¿›å…¥èŠå¤©å®¤

3. å¼€å§‹å‘é€æ¶ˆæ¯ï¼

### å¤šäººèŠå¤©æµ‹è¯•

**æ–¹å¼ä¸€ï¼šå¤šä¸ªæµè§ˆå™¨æ ‡ç­¾**
- æ‰“å¼€å¤šä¸ªæµè§ˆå™¨æ ‡ç­¾é¡µ
- æ¯ä¸ªæ ‡ç­¾éƒ½è¿æ¥åˆ° `ws://localhost:8080`
- åœ¨ä¸åŒæ ‡ç­¾ä¸­å‘é€æ¶ˆæ¯æµ‹è¯•

**æ–¹å¼äºŒï¼šä½¿ç”¨ ngrok å†…ç½‘ç©¿é€**

å¦‚æœä½ æƒ³è®©æœ‹å‹æˆ–å…¶ä»–è®¾å¤‡è®¿é—®ï¼š

1. **å®‰è£… ngrok**
   ```bash
   # Mac
   brew install ngrok
   
   # æˆ–ä»å®˜ç½‘ä¸‹è½½
   # https://ngrok.com/download
   ```

2. **å¯åŠ¨ WebSocket æœåŠ¡å™¨**
   ```bash
   pnpm run ws:server
   # æœåŠ¡å™¨è¿è¡Œåœ¨ 8080 ç«¯å£
   ```

3. **åˆ›å»º ngrok éš§é“**
   ```bash
   ngrok http 8080
   ```
   
   ä½ ä¼šçœ‹åˆ°ï¼š
   ```
   Forwarding  https://abc123.ngrok-free.app -> http://localhost:8080
   ```

4. **è¿æ¥åˆ°å…¬ç½‘åœ°å€**
   
   å°† HTTP åœ°å€æ”¹ä¸º WebSocket åè®®ï¼š
   ```
   wss://abc123.ngrok-free.app
   ```
   
   ä½¿ç”¨è¿™ä¸ªåœ°å€ï¼Œä»»ä½•äººéƒ½å¯ä»¥è¿æ¥åˆ°ä½ çš„èŠå¤©æœåŠ¡å™¨ï¼

### ç”¨æˆ·åè‡ªå®šä¹‰

- ç‚¹å‡»å³ä¸Šè§’çš„ç”¨æˆ·åæŒ‰é’®ï¼ˆå¸¦ç”¨æˆ·å›¾æ ‡ï¼‰
- åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­è¾“å…¥æ–°åå­—
- ç‚¹å‡»"ç¡®å®š"ä¿å­˜

### æ–­å¼€è¿æ¥

- ç‚¹å‡»å³ä¸Šè§’çš„"æ–­å¼€è¿æ¥"æŒ‰é’®
- æˆ–ç‚¹å‡»å·¦ä¸Šè§’è¿”å›æŒ‰é’®è¿”å›é¦–é¡µ

---

## éƒ¨ç½²

### éƒ¨ç½²åˆ° GitHub Pages

1. **ç”Ÿæˆé™æ€æ–‡ä»¶å¹¶éƒ¨ç½²**

```bash
pnpm generate && touch .output/public/.nojekyll && npx gh-pages -d .output/public -b gh-pages -t
```

æˆ–æ·»åŠ åˆ° `package.json`ï¼š

```json
{
  "scripts": {
    "deploy": "pnpm generate && touch .output/public/.nojekyll && npx gh-pages -d .output/public -b gh-pages -t"
  }
}
```

ç„¶åè¿è¡Œï¼š
```bash
pnpm deploy
```

2. **é…ç½® GitHub Pages**

- è¿›å…¥ä»“åº“ Settings â†’ Pages
- Source é€‰æ‹© `gh-pages` åˆ†æ”¯
- ç‚¹å‡» Save

3. **è®¿é—®**

è®¿é—® `https://<username>.github.io/<repo-name>/`

### WebSocket æœåŠ¡å™¨éƒ¨ç½²

å‰ç«¯éƒ¨ç½²åˆ° GitHub Pages åï¼ŒWebSocket æœåŠ¡å™¨éœ€è¦éƒ¨ç½²åˆ°æœ‰å…¬ç½‘ IP çš„æœåŠ¡å™¨ï¼š

**æ¨èæ–¹æ¡ˆï¼š**
- **äº‘æœåŠ¡å™¨**ï¼šé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€AWS ç­‰
- **Serverless**ï¼šVercelã€Railwayã€Fly.io ç­‰ï¼ˆéœ€è¦æ”¹é€ ï¼‰
- **å®¹å™¨åŒ–**ï¼šDocker + Kubernetes

**éƒ¨ç½²æ­¥éª¤ï¼ˆä»¥ Linux æœåŠ¡å™¨ä¸ºä¾‹ï¼‰ï¼š**

```bash
# 1. ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨
scp -r server user@your-server:/path/to/app

# 2. å®‰è£…ä¾èµ–
npm install

# 3. ä½¿ç”¨ PM2 å®ˆæŠ¤è¿›ç¨‹è¿è¡Œ
npm install -g pm2
pm2 start server/websocket-server.js --name websocket

# 4. ç¡®ä¿é˜²ç«å¢™å¼€æ”¾ 8080 ç«¯å£
```

---

## é¡¹ç›®ç»“æ„

```
websocket/
â”œâ”€â”€ app/                          # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ app.vue                   # æ ¹ç»„ä»¶
â”‚   â”œâ”€â”€ app.config.ts             # åº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ assets/                   # é™æ€èµ„æº
â”‚   â”‚   â””â”€â”€ css/
â”‚   â”‚       â””â”€â”€ tailwind.css      # Tailwind CSS é…ç½®
â”‚   â”œâ”€â”€ composables/              # ç»„åˆå¼å‡½æ•°
â”‚   â”‚   â””â”€â”€ useWebSocket.ts       # WebSocket é€»è¾‘å°è£…
â”‚   â”œâ”€â”€ pages/                    # é¡µé¢è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ index.vue             # é¦–é¡µï¼ˆè¿æ¥é¡µï¼‰
â”‚   â”‚   â””â”€â”€ chat.vue              # èŠå¤©é¡µé¢
â”‚   â””â”€â”€ types/                    # TypeScript ç±»å‹å®šä¹‰
â”‚       â””â”€â”€ websocket.ts          # WebSocket ç›¸å…³ç±»å‹
â”œâ”€â”€ server/                       # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ websocket-server.js       # WebSocket æœåŠ¡å™¨
â”‚   â””â”€â”€ README.md                 # æœåŠ¡å™¨æ–‡æ¡£
â”œâ”€â”€ public/                       # å…¬å…±é™æ€æ–‡ä»¶
â”œâ”€â”€ nuxt.config.ts                # Nuxt é…ç½®
â”œâ”€â”€ tailwind.config.js            # Tailwind é…ç½®
â”œâ”€â”€ tsconfig.json                 # TypeScript é…ç½®
â”œâ”€â”€ package.json                  # é¡¹ç›®ä¾èµ–
â””â”€â”€ README.md                     # é¡¹ç›®æ–‡æ¡£
```

---

## å¼€å‘å‘½ä»¤

```bash
# å®‰è£…ä¾èµ–
pnpm install

# å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
pnpm dev --port 3001

# å¯åŠ¨ WebSocket æœåŠ¡å™¨
pnpm run ws:server

# ä»£ç æ£€æŸ¥
pnpm lint

# ç±»å‹æ£€æŸ¥
pnpm typecheck

# ç”Ÿæˆé™æ€æ–‡ä»¶
pnpm generate

# éƒ¨ç½²åˆ° GitHub Pages
pnpm deploy
```

---

## å¸¸è§é—®é¢˜

### 1. è¿æ¥å¤±è´¥ï¼Ÿ

- ç¡®ä¿ WebSocket æœåŠ¡å™¨å·²å¯åŠ¨
- æ£€æŸ¥åœ°å€æ˜¯å¦æ­£ç¡®ï¼ˆ`ws://` æˆ– `wss://`ï¼‰
- æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦é˜»æ­¢äº† 8080 ç«¯å£

### 2. æ¶ˆæ¯å‘é€å¤±è´¥ï¼Ÿ

- ç¡®ä¿è¿æ¥çŠ¶æ€ä¸º"å·²è¿æ¥"
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

### 3. ngrok è¿æ¥ä¸ä¸Šï¼Ÿ

- ç¡®è®¤ ngrok éš§é“æ­£å¸¸è¿è¡Œ
- ä½¿ç”¨ `wss://` åè®®ï¼ˆä¸æ˜¯ `ws://`ï¼‰
- æ£€æŸ¥ ngrok æ˜¯å¦è¿‡æœŸï¼ˆå…è´¹ç‰ˆæœ‰æ—¶é—´é™åˆ¶ï¼‰

### 4. éƒ¨ç½²åæ— æ³•è¿æ¥ WebSocketï¼Ÿ

- GitHub Pages æ˜¯é™æ€æ‰˜ç®¡ï¼Œä¸æ”¯æŒ WebSocket æœåŠ¡å™¨
- WebSocket æœåŠ¡å™¨éœ€è¦å•ç‹¬éƒ¨ç½²åˆ°æœ‰ Node.js ç¯å¢ƒçš„æœåŠ¡å™¨
- ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„æœåŠ¡å™¨åœ°å€

---

## æ–‡æ¡£é“¾æ¥

- [Nuxt 3 æ–‡æ¡£](https://nuxt.com/docs)
- [Nuxt UI æ–‡æ¡£](https://ui.nuxt.com/)
- [WebSocket API æ–‡æ¡£](https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket)
- [ws åº“æ–‡æ¡£](https://github.com/websockets/ws)
- [ngrok æ–‡æ¡£](https://ngrok.com/docs)

---

## è®¸å¯è¯

MIT License

---

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

**Happy Coding! ğŸ‰**
