import{r as I,F as fe,d as he,G as ve,u as me,H as pe,k as ae,o as ge,y as A,z,A as s,C as $e,I as ne,J as re,K as g,B as Y,D as we,L as ye,M as ie,N as ue,O as ce,P as le,T as Me,Q as ke,R as Se,S as _e,U as be,_ as xe}from"./Qn8JTQ2N.js";var Q=(b=>(b.USER="user",b.SYSTEM="system",b.SYSTEM_SETTINGS="system_settings",b))(Q||{});function De(b){return b&&b.__esModule&&Object.prototype.hasOwnProperty.call(b,"default")?b.default:b}var se={exports:{}},Ce=se.exports,de;function Te(){return de||(de=1,(function(b,X){(function(B,O){b.exports=O()})(Ce,(function(){var B=1e3,O=6e4,W=36e5,v="millisecond",f="second",$="minute",w="hour",x="day",k="week",y="month",T="quarter",D="year",S="date",q="Invalid Date",V=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,L=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,j={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(i){var n=["th","st","nd","rd"],e=i%100;return"["+i+(n[(e-20)%10]||n[e]||n[0])+"]"}},H=function(i,n,e){var r=String(i);return!r||r.length>=n?i:""+Array(n+1-r.length).join(e)+i},P={s:H,z:function(i){var n=-i.utcOffset(),e=Math.abs(n),r=Math.floor(e/60),t=e%60;return(n<=0?"+":"-")+H(r,2,"0")+":"+H(t,2,"0")},m:function i(n,e){if(n.date()<e.date())return-i(e,n);var r=12*(e.year()-n.year())+(e.month()-n.month()),t=n.clone().add(r,y),u=e-t<0,c=n.clone().add(r+(u?-1:1),y);return+(-(r+(e-t)/(u?t-c:c-t))||0)},a:function(i){return i<0?Math.ceil(i)||0:Math.floor(i)},p:function(i){return{M:y,y:D,w:k,d:x,D:S,h:w,m:$,s:f,ms:v,Q:T}[i]||String(i||"").toLowerCase().replace(/s$/,"")},u:function(i){return i===void 0}},E="en",N={};N[E]=j;var h="$isDayjsObject",m=function(i){return i instanceof ee||!(!i||!i[h])},o=function i(n,e,r){var t;if(!n)return E;if(typeof n=="string"){var u=n.toLowerCase();N[u]&&(t=u),e&&(N[u]=e,t=u);var c=n.split("-");if(!t&&c.length>1)return i(c[0])}else{var d=n.name;N[d]=n,t=d}return!r&&t&&(E=t),t||!r&&E},a=function(i,n){if(m(i))return i.clone();var e=typeof n=="object"?n:{};return e.date=i,e.args=arguments,new ee(e)},l=P;l.l=o,l.i=m,l.w=function(i,n){return a(i,{locale:n.$L,utc:n.$u,x:n.$x,$offset:n.$offset})};var ee=(function(){function i(e){this.$L=o(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[h]=!0}var n=i.prototype;return n.parse=function(e){this.$d=(function(r){var t=r.date,u=r.utc;if(t===null)return new Date(NaN);if(l.u(t))return new Date;if(t instanceof Date)return new Date(t);if(typeof t=="string"&&!/Z$/i.test(t)){var c=t.match(V);if(c){var d=c[2]-1||0,p=(c[7]||"0").substring(0,3);return u?new Date(Date.UTC(c[1],d,c[3]||1,c[4]||0,c[5]||0,c[6]||0,p)):new Date(c[1],d,c[3]||1,c[4]||0,c[5]||0,c[6]||0,p)}}return new Date(t)})(e),this.init()},n.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},n.$utils=function(){return l},n.isValid=function(){return this.$d.toString()!==q},n.isSame=function(e,r){var t=a(e);return this.startOf(r)<=t&&t<=this.endOf(r)},n.isAfter=function(e,r){return a(e)<this.startOf(r)},n.isBefore=function(e,r){return this.endOf(r)<a(e)},n.$g=function(e,r,t){return l.u(e)?this[r]:this.set(t,e)},n.unix=function(){return Math.floor(this.valueOf()/1e3)},n.valueOf=function(){return this.$d.getTime()},n.startOf=function(e,r){var t=this,u=!!l.u(r)||r,c=l.p(e),d=function(J,C){var R=l.w(t.$u?Date.UTC(t.$y,C,J):new Date(t.$y,C,J),t);return u?R:R.endOf(x)},p=function(J,C){return l.w(t.toDate()[J].apply(t.toDate("s"),(u?[0,0,0,0]:[23,59,59,999]).slice(C)),t)},M=this.$W,_=this.$M,U=this.$D,K="set"+(this.$u?"UTC":"");switch(c){case D:return u?d(1,0):d(31,11);case y:return u?d(1,_):d(0,_+1);case k:var F=this.$locale().weekStart||0,Z=(M<F?M+7:M)-F;return d(u?U-Z:U+(6-Z),_);case x:case S:return p(K+"Hours",0);case w:return p(K+"Minutes",1);case $:return p(K+"Seconds",2);case f:return p(K+"Milliseconds",3);default:return this.clone()}},n.endOf=function(e){return this.startOf(e,!1)},n.$set=function(e,r){var t,u=l.p(e),c="set"+(this.$u?"UTC":""),d=(t={},t[x]=c+"Date",t[S]=c+"Date",t[y]=c+"Month",t[D]=c+"FullYear",t[w]=c+"Hours",t[$]=c+"Minutes",t[f]=c+"Seconds",t[v]=c+"Milliseconds",t)[u],p=u===x?this.$D+(r-this.$W):r;if(u===y||u===D){var M=this.clone().set(S,1);M.$d[d](p),M.init(),this.$d=M.set(S,Math.min(this.$D,M.daysInMonth())).$d}else d&&this.$d[d](p);return this.init(),this},n.set=function(e,r){return this.clone().$set(e,r)},n.get=function(e){return this[l.p(e)]()},n.add=function(e,r){var t,u=this;e=Number(e);var c=l.p(r),d=function(_){var U=a(u);return l.w(U.date(U.date()+Math.round(_*e)),u)};if(c===y)return this.set(y,this.$M+e);if(c===D)return this.set(D,this.$y+e);if(c===x)return d(1);if(c===k)return d(7);var p=(t={},t[$]=O,t[w]=W,t[f]=B,t)[c]||1,M=this.$d.getTime()+e*p;return l.w(M,this)},n.subtract=function(e,r){return this.add(-1*e,r)},n.format=function(e){var r=this,t=this.$locale();if(!this.isValid())return t.invalidDate||q;var u=e||"YYYY-MM-DDTHH:mm:ssZ",c=l.z(this),d=this.$H,p=this.$m,M=this.$M,_=t.weekdays,U=t.months,K=t.meridiem,F=function(C,R,G,te){return C&&(C[R]||C(r,u))||G[R].slice(0,te)},Z=function(C){return l.s(d%12||12,C,"0")},J=K||function(C,R,G){var te=C<12?"AM":"PM";return G?te.toLowerCase():te};return u.replace(L,(function(C,R){return R||(function(G){switch(G){case"YY":return String(r.$y).slice(-2);case"YYYY":return l.s(r.$y,4,"0");case"M":return M+1;case"MM":return l.s(M+1,2,"0");case"MMM":return F(t.monthsShort,M,U,3);case"MMMM":return F(U,M);case"D":return r.$D;case"DD":return l.s(r.$D,2,"0");case"d":return String(r.$W);case"dd":return F(t.weekdaysMin,r.$W,_,2);case"ddd":return F(t.weekdaysShort,r.$W,_,3);case"dddd":return _[r.$W];case"H":return String(d);case"HH":return l.s(d,2,"0");case"h":return Z(1);case"hh":return Z(2);case"a":return J(d,p,!0);case"A":return J(d,p,!1);case"m":return String(p);case"mm":return l.s(p,2,"0");case"s":return String(r.$s);case"ss":return l.s(r.$s,2,"0");case"SSS":return l.s(r.$ms,3,"0");case"Z":return c}return null})(C)||c.replace(":","")}))},n.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},n.diff=function(e,r,t){var u,c=this,d=l.p(r),p=a(e),M=(p.utcOffset()-this.utcOffset())*O,_=this-p,U=function(){return l.m(c,p)};switch(d){case D:u=U()/12;break;case y:u=U();break;case T:u=U()/3;break;case k:u=(_-M)/6048e5;break;case x:u=(_-M)/864e5;break;case w:u=_/W;break;case $:u=_/O;break;case f:u=_/B;break;default:u=_}return t?u:l.a(u)},n.daysInMonth=function(){return this.endOf(y).$D},n.$locale=function(){return N[this.$L]},n.locale=function(e,r){if(!e)return this.$L;var t=this.clone(),u=o(e,r,!0);return u&&(t.$L=u),t},n.clone=function(){return l.w(this.$d,this)},n.toDate=function(){return new Date(this.valueOf())},n.toJSON=function(){return this.isValid()?this.toISOString():null},n.toISOString=function(){return this.$d.toISOString()},n.toString=function(){return this.$d.toUTCString()},i})(),oe=ee.prototype;return a.prototype=oe,[["$ms",v],["$s",f],["$m",$],["$H",w],["$W",x],["$M",y],["$y",D],["$D",S]].forEach((function(i){oe[i[1]]=function(n){return this.$g(n,i[0],i[1])}})),a.extend=function(i,n){return i.$i||(i(n,ee,a),i.$i=!0),a},a.locale=o,a.isDayjs=m,a.unix=function(i){return a(1e3*i)},a.en=N[E],a.Ls=N,a.p={},a}))})(se)),se.exports}var Oe=Te();const Ue=De(Oe);function Ne(b,X={}){const{autoReconnect:B=!0,reconnectInterval:O=3e3,maxReconnectAttempts:W=5}=X,v=I(null),f=I("disconnected"),$=I(""),w=I(0),x=I([]),k=I({id:"",name:""});let y=null;const T=h=>{k.value=h},D=h=>{k.value.name=h},S=h=>{const m=new Date(h),o=m.getHours().toString().padStart(2,"0"),a=m.getMinutes().toString().padStart(2,"0");return`${o}:${a}`},q=h=>{x.value.forEach(m=>{m.fromUserId===h.fromUserId&&!m.id&&m.sentTime===h.sentTime&&(m.id=h.id)})},V=h=>{x.value.push(h)},L=()=>{y&&(clearTimeout(y),y=null)},j=h=>{const m=h||b;if(!m){$.value="WebSocket URL ä¸èƒ½ä¸ºç©º",f.value="error";return}v.value&&H();try{f.value="connecting",$.value="",console.log("ğŸ”Œ æ­£åœ¨è¿æ¥:",m),v.value=new WebSocket(m),v.value.onopen=()=>{console.log("âœ… WebSocket è¿æ¥æˆåŠŸ"),f.value="connected",w.value=0},v.value.onmessage=o=>{console.log("event",o);const a=JSON.parse(o.data);if(console.log("ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯:",a),a.fromUserId===k.value.id){q(a);return}if(a.type===Q.SYSTEM_SETTINGS){T(a.settingInfo);return}V(a)},v.value.onerror=o=>{console.error("âŒ WebSocket é”™è¯¯:",o),$.value="WebSocket è¿æ¥é”™è¯¯",f.value="error"},v.value.onclose=o=>{console.log("ğŸ”Œ WebSocket è¿æ¥å…³é—­",o.code,o.reason),f.value="disconnected",B&&w.value<W?(w.value++,console.log(`ğŸ”„ å°è¯•é‡è¿ (${w.value}/${W})...`),L(),y=setTimeout(()=>{j(m)},O)):w.value>=W&&($.value=`é‡è¿å¤±è´¥ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡è¿æ¬¡æ•° (${W})`,f.value="error")}}catch(o){console.error("âŒ åˆ›å»º WebSocket å¤±è´¥:",o),$.value=o instanceof Error?o.message:"æœªçŸ¥é”™è¯¯",f.value="error"}},H=()=>{L(),v.value&&(console.log("ğŸ”Œ æ–­å¼€ WebSocket è¿æ¥"),v.value.close(),v.value=null),f.value="disconnected",w.value=0},P=()=>{$.value=""},E=h=>{if(!v.value)return $.value="WebSocket æœªè¿æ¥",!1;if(v.value.readyState!==WebSocket.OPEN)return $.value="WebSocket è¿æ¥æœªå°±ç»ª",!1;try{return v.value.send(JSON.stringify(h)),V(h),!0}catch(m){return console.error("âŒ å‘é€æ¶ˆæ¯å¤±è´¥:",m),$.value=m instanceof Error?m.message:"å‘é€å¤±è´¥",!1}},N=()=>{x.value=[]};return fe(()=>{H()}),{ws:v,status:f,error:$,reconnectAttempts:w,messages:x,userInfo:k,connect:j,disconnect:H,sendMessage:E,clearMessages:N,resetError:P,formatTime:S,initUserInfo:T,changeUserName:D}}const Ie={class:"chat-container"},We={class:"chat-wrapper"},je={class:"chat-card"},He={class:"chat-header"},Ee={class:"header-left"},Ye={class:"connection-info"},Be={class:"connection-status"},Le={class:"status-text"},Re={class:"connection-url"},Ae={class:"header-right"},ze={class:"user-name-text"},Ve=["disabled"],Fe={class:"modal-body"},Je={class:"messages-list"},qe={key:0,class:"empty-state"},Ke={key:0,class:"message justify-center"},Pe={class:"flex justify-center items-center gap-2",style:{color:"beige"}},Ze={class:"message-text"},Ge={class:"message-time"},Qe={class:"flex flex-col"},Xe={class:"message-content"},et={class:"message-text"},tt={class:"message-time"},nt={key:0,class:"error-banner"},st={class:"input-container"},rt=["disabled"],ot=["disabled"],at=he({__name:"chat",setup(b){const X=ve(),B=me(),O=I(X.query.url||"");O.value||B.push("/");const{connect:W,disconnect:v,status:f,error:$,messages:w,sendMessage:x,userInfo:k,changeUserName:y}=Ne(),T=I(""),D=I(!1),S=I(""),q=()=>{S.value=k.value.name,D.value=!0},V=()=>{S.value.trim()&&(y(S.value.trim()),D.value=!1)},L=()=>{D.value=!1,S.value=""},j=I(null),H=()=>{be(()=>{j.value&&(j.value.scrollTop=j.value.scrollHeight)})};pe(w,()=>{H()});const P=ae(()=>{switch(f.value){case"connecting":return"è¿æ¥ä¸­...";case"connected":return"å·²è¿æ¥";case"disconnected":return"æœªè¿æ¥";case"error":return"è¿æ¥é”™è¯¯";default:return"æœªçŸ¥"}}),E=ae(()=>{switch(f.value){case"connected":return"status-connected";case"connecting":return"status-connecting";case"error":return"status-error";default:return"status-disconnected"}});ge(()=>{O.value&&W(O.value)});const N=()=>{v(),B.push("/")},h=()=>{T.value.trim()&&(x({type:Q.USER,content:T.value.trim(),sentTime:Ue().format("MM/DD HH:mm"),fromUserId:k.value.id,fromUserName:k.value.name}),T.value="")};return(m,o)=>(z(),A("div",Ie,[o[14]||(o[14]=s("div",{class:"background-gradient"},null,-1)),s("div",We,[s("div",je,[s("div",He,[s("div",Ee,[s("button",{class:"back-button",onClick:N},[...o[6]||(o[6]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"back-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),s("div",Ye,[s("div",Be,[s("span",{class:re(["status-dot",g(E)])},null,2),s("span",Le,Y(g(P)),1)]),s("div",Re,Y(g(O)),1)])]),s("div",Ae,[s("button",{class:"user-name-button",onClick:q,title:"ç‚¹å‡»ä¿®æ”¹ç”¨æˆ·å"},[o[7]||(o[7]=s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),s("circle",{cx:"12",cy:"7",r:"4"})],-1)),s("span",ze,Y(g(k).name||"æœªè®¾ç½®"),1),o[8]||(o[8]=s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",class:"edit-icon"},[s("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),s("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1))]),s("button",{class:"disconnect-button",onClick:o[0]||(o[0]=(...a)=>g(v)&&g(v)(...a)),disabled:g(f)!=="connected"}," æ–­å¼€è¿æ¥ ",8,Ve)])]),$e(Me,{name:"modal"},{default:we(()=>[g(D)?(z(),A("div",{key:0,class:"modal-overlay",onClick:L},[s("div",{class:"modal-box",onClick:o[2]||(o[2]=ye(()=>{},["stop"]))},[s("div",{class:"modal-header"},[o[10]||(o[10]=s("h3",{class:"modal-title"},"ä¿®æ”¹ç”¨æˆ·å",-1)),s("button",{class:"modal-close",onClick:L},[...o[9]||(o[9]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),s("div",Fe,[ie(s("input",{"onUpdate:modelValue":o[1]||(o[1]=a=>ce(S)?S.value=a:null),type:"text",class:"name-input",placeholder:"è¯·è¾“å…¥ç”¨æˆ·å",onKeyup:ue(V,["enter"]),autofocus:""},null,544),[[le,g(S)]])]),s("div",{class:"modal-footer"},[s("button",{class:"modal-btn modal-btn-cancel",onClick:L},"å–æ¶ˆ"),s("button",{class:"modal-btn modal-btn-confirm",onClick:V},"ç¡®å®š")])])])):ne("",!0)]),_:1}),s("div",{ref_key:"messagesContainer",ref:j,class:"messages-container no-scrollbar"},[s("div",Je,[g(w).length===0?(z(),A("div",qe,[...o[11]||(o[11]=[ke('<div class="empty-icon" data-v-fe6798d5><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-fe6798d5><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" data-v-fe6798d5></path></svg></div><p class="empty-text" data-v-fe6798d5>æš‚æ— æ¶ˆæ¯</p><p class="empty-hint" data-v-fe6798d5>å‘é€ä¸€æ¡æ¶ˆæ¯å¼€å§‹èŠå¤©å§</p>',3)])])):ne("",!0),(z(!0),A(Se,null,_e(g(w),a=>(z(),A("div",{key:a.id},[a.type===g(Q).SYSTEM?(z(),A("div",Ke,[s("div",Pe,[s("span",Ze,Y(a.content),1),s("span",Ge,Y(a.sentTime),1)])])):a.type===g(Q).USER?(z(),A("div",{key:1,class:re(["message",a.fromUserId===g(k).id?"message-sent":"message-received"])},[s("div",Qe,[s("div",{class:re(["text-end",a.fromUserId===g(k).id?"text-end":"text-start"]),style:{color:"beige"}},[s("span",null,Y(a.fromUserName),1)],2),s("div",Xe,[s("p",et,Y(a.content),1),s("span",tt,Y(a.sentTime),1)])])],2)):ne("",!0)]))),128))])],512),g($)?(z(),A("div",nt,[o[12]||(o[12]=s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"error-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),s("span",null,Y(g($)),1)])):ne("",!0),s("div",st,[ie(s("input",{"onUpdate:modelValue":o[3]||(o[3]=a=>ce(T)?T.value=a:null),type:"text",placeholder:"è¾“å…¥æ¶ˆæ¯...",class:"message-input",onKeyup:o[4]||(o[4]=ue(a=>h(),["enter"])),disabled:g(f)!=="connected"},null,40,rt),[[le,g(T)]]),s("button",{class:"send-button",onClick:o[5]||(o[5]=a=>h()),disabled:!g(T).trim()||g(f)!=="connected"},[...o[13]||(o[13]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"send-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)])],8,ot)])])])]))}}),ut=xe(at,[["__scopeId","data-v-fe6798d5"]]);export{ut as default};
